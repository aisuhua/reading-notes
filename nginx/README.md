# Nginx

Nginx 服务器的一个显著优势是能够同时处理大量并发请求。它结合多进程机制和异步机制对外提供服务。异步机制使用的是异步非阻塞。

## 如何处理请求

两种进程模式：

- Signal 模式
- Master-Worker（Master-Slave）模式

每个工作进程使用了异步非阻塞方式，可以处理多个客户端请求。当某个工作进程接收到客户端的请求后，调用 I/O 进行处理，如果不能立即得到结果，就去处理其他请求；而客户端在此期间无需等待响应，可以去处理其他事情；当 I/O 调用返回结果时，就会通知此工作进程；该进程得到通知，暂时挂起当前处理的事务，去响应客户端请求。

客户端请求数量增长，网络负载繁重时，Nginx 服务器使用多进程机制保证不增长对系统资源的压力；同时使用异步非阻塞方式减少了工作进程在 IO 调用上的阻塞延迟，保证了不降低对请求的处理能力。

## 事件处理机制

Nginx 服务器的工作进程调用 IO 后，就去进行其他工作了；当 IO 调用返回后，会通知工作进程。这里有一个问题，IO 调用时如何把自己的状态通知给工作进程的呢？

一般解决这个问题的方案有两种：

1. 让工作进程在进行其他工作的过程中间隔一段时间就去检查一下 IO 的运行状态，如果完成，就去响应客户端，如果未完成，就继续正在进行的工作。
2. IO 调用在完成后能主动通知工作进程。对于前者，虽然工作进程在 IO 调用过程中没有等待，但不断的检查仍然在时间和资源上导致了不小的开销，最理想的解决方案是第二种。

具体来说，select/poll/epoll/kqueue 等这样的系统调用就是用来支持第二种解决方案的。这些系统调用，也常被称为**事件驱动模式**，它们提供了一种机制，让进程可以同时处理多个并发请求，不用关心 IO 调用的具体状态。IO 调用完全由事件驱动模式来管理，事件准备好之后就通知工作进程事件已经就绪。




